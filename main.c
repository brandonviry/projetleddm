/*
 *led.c
 *
 * Created: 15/02/2021 11:33:21
 *  Author: viry Brandon ,bocace stefane
 */ 

#include <avr/io.h>
#define F_CPU 16000000UL
uint8_t etat = 0;
void initialisation(void){
//------------------------------------------------------------------
    DDRD |=  (1<<3);		  
    DDRC &=~ ((1<<4)|(1<<5)); 
    DDRB|=   ((1<<4)|(1<<2));
//------------------------------------------------------------------
    PORTD &=~(1<<3);         
    PORTB &=~ ((1<<4)|(1<<2));
	//PORTC &=~ ((1<<4)|(1<<5));
	PORTC |=(1<<4)|(1<<5);
//------------------------------------------------------------------	
}

void etatLed(uint8_t rouge,uint8_t orange,uint8_t vert){
//------------------------------------------------------------------
	if (vert==1){
		PORTB |=(1<<2);
	}
	else{
		PORTB &=~(1<<2);
	}
//------------------------------------------------------------------
if (orange==1){
	PORTB |=(1<<4);
}
else{
	PORTB &=~(1<<4);
}
//------------------------------------------------------------------	
			if (rouge==1){
				PORTD |=(1<<3);
			}
			else{
				PORTD &=~(1<<3);
			}


//------------------------------------------------------------------			
		}
void seqLED(){
	uint8_t seq[7][3]={{0,0,0},{0,0,1},{0,1,1}, {1,1,1},{0,1,1},{0,0,1},{0,0,0}};
	for (uint8_t i =0; i<8;i++)
	{
		etatLed(seq[i][0],seq[i][1],seq[i][2]);
		
		if ((PINC & (1<<5))==0)
		{
				while ((PINC & (1<<5))==0){
					  asm("NOP");
				}
			etatLed(seq[0][0],seq[0][1],seq[0][2]);
			etat=2;
			break;
		}		
	}
	}
int main(void){

	initialisation();
	while (1){
			if ((PINC & (1<<4))==0){
				while ((PINC & (1<<4))==0){
					  asm("NOP");
				}
				etat =1;
			}
			if(etat==1)seqLED();
			
		  
}
}
